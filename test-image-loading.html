<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Loading Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-container {
            margin: 20px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        img {
            max-width: 200px;
            border: 2px solid #4CAF50;
            margin: 10px;
        }
        .error {
            color: #ff6b6b;
        }
        .success {
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <h1>Supabase Storage Image Loading Test</h1>

    <div class="test-container">
        <h2>Test 1: Direct Storage URL</h2>
        <img
            src="https://rihoufidmnqtffzqhplc.supabase.co/storage/v1/object/public/profile-images/alumni/39-david-a.png"
            alt="David A"
            onload="document.getElementById('test1').className='success'; document.getElementById('test1').textContent='✓ Image loaded successfully!'"
            onerror="document.getElementById('test1').className='error'; document.getElementById('test1').textContent='✗ Failed to load image - Check bucket policies or file exists'"
        />
        <p id="test1">Loading...</p>
    </div>

    <div class="test-container">
        <h2>Test 2: Check if bucket is public</h2>
        <button onclick="testBucketAccess()">Test Bucket Access</button>
        <p id="test2">Click button to test</p>
    </div>

    <div class="test-container">
        <h2>Test 3: Fetch all profile images</h2>
        <button onclick="fetchProfiles()">Fetch Profiles from Database</button>
        <div id="profiles-container"></div>
        <p id="test3">Click button to fetch</p>
    </div>

    <script>
        async function testBucketAccess() {
            const result = document.getElementById('test2');
            result.textContent = 'Testing...';

            try {
                const response = await fetch('https://rihoufidmnqtffzqhplc.supabase.co/storage/v1/object/public/profile-images/alumni/39-david-a.png');
                if (response.ok) {
                    result.className = 'success';
                    result.textContent = `✓ Bucket is public and accessible! Status: ${response.status}`;
                } else {
                    result.className = 'error';
                    result.textContent = `✗ Access denied! Status: ${response.status}`;
                }
            } catch (error) {
                result.className = 'error';
                result.textContent = `✗ Error: ${error.message}`;
            }
        }

        async function fetchProfiles() {
            const container = document.getElementById('profiles-container');
            const result = document.getElementById('test3');
            result.textContent = 'Fetching...';

            try {
                const response = await fetch('https://rihoufidmnqtffzqhplc.supabase.co/rest/v1/profiles?select=id,name,profile_image_url&limit=5', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpaG91ZmlkbW5xdGZmenFocGxjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MjgwNTMsImV4cCI6MjA3NzMwNDA1M30.15vQ08-ij2ihEMM0sVsdLJdhGFaqhXp_7fb1aB1WHis',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpaG91ZmlkbW5xdGZmenFocGxjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MjgwNTMsImV4cCI6MjA3NzMwNDA1M30.15vQ08-ij2ihEMM0sVsdLJdhGFaqhXp_7fb1aB1WHis'
                    }
                });

                const profiles = await response.json();

                container.innerHTML = profiles.map(p => `
                    <div style="display: inline-block; margin: 10px; text-align: center;">
                        <img src="${p.profile_image_url || '/placeholder.png'}"
                             alt="${p.name}"
                             style="display: block;"
                             onload="this.nextElementSibling.textContent='✓ Loaded'"
                             onerror="this.nextElementSibling.textContent='✗ Failed'; this.nextElementSibling.className='error'">
                        <p style="margin: 5px 0;">${p.name}</p>
                        <small class="success">Loading...</small>
                    </div>
                `).join('');

                result.className = 'success';
                result.textContent = `✓ Fetched ${profiles.length} profiles`;
            } catch (error) {
                result.className = 'error';
                result.textContent = `✗ Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
